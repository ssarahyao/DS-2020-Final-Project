---
title: "Affordability of Fresh Fruits in the U.S. in 2022: A Cup-Equivalent Price Analysis"
author: "Sarah Yao, Isabel Lange"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

The goal of this project is to analyze the affordability of fruits in the United States in 2022, focusing on their price per edible cup equivalent. Access to nutritious fruits is a key component of a healthy diet, yet prices vary widely depending on fruit type and form (fresh, frozen, canned, juice). Understanding which fruits are most and least affordable can help consumers make informed dietary choices and highlight potential areas for improving access to nutritious foods.

In pursuit of the stated goal, we will explore the following questions:

**1. Which fruits are most and least affordable per edible cup equivalent?**

We will sort all fruits by cup-equivalent price and identify the top 5 cheapest and most expensive fruits. A bar chart will visualize all fruits ranked by price, colored by fruit form, to contextualize affordability in terms of nutrition.

**2. How does fruit form (fresh vs. processed) affect price per cup?**

By grouping the data by form (Fresh, Canned, Frozen, Juice), we will compute mean, median, and standard deviation of cup-equivalent prices. A boxplot will compare price distributions across forms. This analysis will reveal whether fresh fruits tend to be cheaper or more expensive than processed forms.

**3. What is the relationship between fruit yield and cup-equivalent price?**

We will calculate the correlation between yield and cup-equivalent price, fit a linear regression model, and plot a scatterplot with a regression line. This will allow us to determine whether higher-yield fruits tend to be more affordable.

**4. Is there high variability across fruit types in price per cup?**

Summary statistics including variance, standard deviation, range, and interquartile range will quantify price variability. A histogram  will visualize the spread, highlighting where most fruit prices cluster. This analysis will provide insights into consumer access and price stability across fruit categories.

Through the completion of this project, we aim to identify patterns in fruit affordability across the U.S. in 2022 and provide meaningful conclusions regarding the accessibility of nutritious foods for consumers.

## Data

### Structure

The link to the dataset is https://www.ers.usda.gov/data-products/fruit-and-vegetable-prices
. The USDA Economic Research Service (ERS) website provides datasets containing average retail prices of fruits and vegetables in the U.S. for selected years (2013, 2016, 2020, 2022). Each dataset contains multiple tables with price data for fresh, frozen, canned, and juice forms of fruits and vegetables. For each fruit item, information includes retail price, yield, and cost per cup-equivalent. The datasets are compiled from retail scanner data provided by Circana/IRI across a variety of store types.

For this project, we are analyzing the dataset titled “ALL FRUITS – Average Prices” for the year 2022. This table contains 62 fruit items with data on retail price, yield, and cup-equivalent cost. Focusing on 2022 ensures that the data is recent, consistent in reporting methods, and allows us to study the current affordability of fruits in terms of nutrition-relevant units.

The dataset includes multiple forms of each fruit—fresh, canned, frozen, and juice. To manage the dataset and focus on meaningful analysis, we will include all 62 fruits but retain key variables: fruit name, form, retail price, yield, and cup-equivalent price. These variables provide enough information to analyze affordability, variability, and the relationship between fruit form and price. The dataset structure is as follows: each row corresponds to a unique fruit item in a specific form. The retail price column contains the average price in dollars, the yield column gives the fraction edible, and the cup-equivalent price column represents the cost per nutrition-relevant serving.

This structure allows us to perform analyses such as ranking fruits by cup-equivalent price, comparing prices across fruit forms, exploring correlations with yield, and quantifying variability across fruit types, while keeping the dataset manageable and focused on the core research questions.

### Cleaning 

First, we read in the CSV file for 2022.

```{r}
library(tidyverse)

fruit_2022 <- read_csv("Fruit-Prices-2022.csv")

```

Inspect the first few rows and column names

```{r}

head(fruit_2022)
colnames(fruit_2022)

```

Select only the relevant variables for analysis
Variables: Fruit name, Form, Retail Price, Yield, Cup-Equivalent Price

```{r}

fruit_2022 <- fruit_2022 %>% 
  select(Fruit, Form, RetailPrice, Yield, CupEquivalentPrice)


```

Check for missing values

```{r}

colSums(is.na(fruit_2022))

```

Ensure numeric columns are correctly formatted

```{r}

fruit_2022$RetailPrice <- as.numeric(fruit_2022$RetailPrice)
fruit_2022$Yield <- as.numeric(fruit_2022$Yield)
fruit_2022$CupEquivalentPrice <- as.numeric(fruit_2022$CupEquivalentPrice)

```

Check for duplicates

```{r}

sum(duplicated(fruit_2022))

```

Looks good! This dataset was pretty clean. We will save the cleaned dataset containing only the variables needed for this project to improve readability and make it easier to use in analysis.
``` {r}

write.csv(fruit_2022, "fruit_2022_clean.csv", row.names = FALSE)

```

### Variables

Fruit: The name of the fruit item (e.g., Apples, Strawberries, Oranges).

Form: The form in which the fruit is sold (Fresh, Frozen, Canned, Dried, or Juice).

RetailPrice: The average retail price of the fruit per standard unit in U.S. dollars.

Yield: The fraction of the fruit that is edible (e.g., 0.6 for 60% edible).

CupEquivalentPrice: The cost of one edible cup-equivalent of the fruit in U.S. dollars, calculated using retail price and yield.


## Results

```{r}

library(readr)
library(tidyverse)
clean <- read_csv("fruit_2022_clean.csv")

```
### Question 1: Which fruits are most and least affordable per edible cup equivalent?

To identify the most expensive fruits per edible cup equivalent, we will group fruits by their base names (for example, "Cherries" and "Cherries, packed in syrup or water" are grouped together) and calculate the average cup-equivalent price, ignoring the different forms for this analysis, as the goal is to identify the fruit itself.

```{r}
library(dplyr)
library(stringr)
library(purrr)

# Define your base fruits
base_fruits <- c("Apples", "Apricots", "Bananas", "Berries", "Blackberries", 
                 "Blueberries", "Cantaloupe", "Cherries", "Clementines", 
                 "Cranberries", "Dates", "Figs", "Fruit cocktail", "Grapefruit", 
                 "Grapes", "Honeydew", "Kiwi", "Mangoes", "Nectarines", "Oranges", 
                 "Papaya", "Peaches", "Pears", "Pineapple", "Plum", "Pomegranate", 
                 "Raspberries", "Strawberries")

# Create a FacetGroup column based on matching base fruits
clean <- clean %>%
  mutate(FacetGroup = map_chr(Fruit, ~ {
    matched <- base_fruits[str_detect(.x, base_fruits)]
    if(length(matched) > 0) matched[1] else .x
  }))

# Compute average cup-equivalent price per base fruit
clean_base <- clean %>%
  group_by(FacetGroup) %>%
  summarise(AvgPrice = mean(CupEquivalentPrice, na.rm = TRUE)) %>%
  ungroup() %>%
  arrange(AvgPrice)

# Top 5 cheapest base fruits
cheapest_fruits <- head(clean_base, 5)
cheapest_fruits

# Top 5 most expensive base fruits
most_expensive_fruits <- tail(clean_base, 5) %>%
  arrange(desc(AvgPrice))
most_expensive_fruits
```

Let's visualize the data with a bar graph. The graph shows all fruits and their average cup-equivalent price, grouped by base fruit. Different forms of the same fruit are averaged together, so only one bar per base fruit is shown.

```{r, fig.width=12, fig.height=20}

library(ggplot2)

# Compute average price per base fruit
avg_price <- clean %>%
  group_by(FacetGroup) %>%
  summarise(AvgPrice = mean(CupEquivalentPrice, na.rm = TRUE)) %>%
  ungroup() %>%
  arrange(AvgPrice)

# Plot bar graph
ggplot(avg_price, aes(x = reorder(FacetGroup, AvgPrice), y = AvgPrice)) +
  geom_col(fill = "pink") +
  geom_text(aes(label = round(AvgPrice, 2)), vjust = -0.5, size = 3) +
  labs(
    title = "Average Cup-Equivalent Price of Fruits by Base Fruit",
    x = "Base Fruit",
    y = "Average Price per Cup Equivalent ($)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
    axis.title = element_text(size = 12),
    plot.title = element_text(size = 14, face = "bold")
  )

```

Our graph confirms that, based on the average price per cup equivalent, watermelon is the cheapest fruit ($0.24), while cherries are the most expensive ($2.64).

If we want to further examine the breakdown of different fruit forms, the graph below shows each form for all fruits.

```{r, fig.width=12, fig.height=20}

library(stringr)

# Define base fruits we care about
base_fruits <- c("Apples", "Apricots", "Bananas", "Berries", "Blackberries", "Blueberries", "Cantaloupe", "Cherries", "Clementines", "Cranberries", "Dates", "Figs", "Fruit cocktail", "Grapefruit", "Grapes", "Honeydew", "Kiwi", "Mangoes", "Nectarines", "Oranges", "Papaya", "Peaches", "Pears", "Pineapple", "Plum", "Pomegranate", "Raspberries", "Strawberries")

# Create a grouping column for faceting
clean <- clean %>%
  mutate(FacetGroup = map_chr(Fruit, ~ {
    matched <- base_fruits[str_detect(.x, base_fruits)]
    if(length(matched) > 0) matched[1] else .x
  }))

# Plot: facet by shared fruit group, keep original names on x-axis
ggplot(clean, aes(x = Form, y = CupEquivalentPrice, fill = Form)) +
  geom_col() +
  facet_wrap(~ FacetGroup, scales = "fixed") +   # fixed y-axis for all facets
  geom_text(aes(label = round(CupEquivalentPrice, 2)),
            position = position_stack(vjust = 0.5), size = 3) +
  theme_bw() +
  theme(
    axis.text.x = element_blank(),      
    axis.ticks.x = element_blank(),
    strip.text = element_text(size = 10, face = "bold"),
    axis.text.y = element_text(size = 10),
    axis.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    legend.title = element_text(size = 11),
    panel.spacing = unit(1, "lines")
  ) +
  labs(
    title = "Cup-Equivalent Price by Form (Grouped by Base Fruit)",
    x = "Fruit",
    y = "Price per Cup Equivalent ($)"
  )
```
From this graph, we can see that even when considering different fruit forms, watermelon, which is only available fresh, remains the cheapest ($0.24), while canned cherries remain the most expensive ($3.56).

Building on this, we can now analyze how fruit form affects the price per cup equivalent.

### Question 2: How does fruit form (fresh vs. processed) affect price per cup?

```{r}



```

### Question 3: What is the relationship between fruit yield and cup-equivalent price?

```{r}



```

### Question 4: Is there high variability across fruit types in price per cup?

```{r}



```




